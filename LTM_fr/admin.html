<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Qu·∫£n L√Ω N·ªôi Th·∫•t</title>
    <link rel="stylesheet" href="admin.css">
</head>
<body>
    <div class="header">
        <h1>üè† Admin Panel - Qu·∫£n L√Ω N·ªôi Th·∫•t</h1>
        <p>H·ªá th·ªëng qu·∫£n l√Ω to√†n di·ªán cho c·ª≠a h√†ng n·ªôi th·∫•t</p>
    </div>

    <div class="nav">
        <div class="nav-buttons">
            <button class="nav-btn active" onclick="showSection('dashboard')">üìä Dashboard</button>
            <button class="nav-btn" onclick="showSection('users')">üë• Ng∆∞·ªùi d√πng</button>
            <button class="nav-btn" onclick="showSection('categories')">üìÇ Danh m·ª•c</button>
            <button class="nav-btn" onclick="showSection('products')">üõãÔ∏è S·∫£n ph·∫©m</button>
            <button class="nav-btn" onclick="showSection('orders')">üìã ƒê∆°n h√†ng</button>
        </div>
    </div>

    <div class="container">
        <!-- Dashboard Section -->
        <div id="dashboard" class="section active">
            <div class="section-header">
                <h2 class="section-title">üìä T·ªïng quan h·ªá th·ªëng</h2>
            </div>
            
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalUsers">0</div>
                    <div class="stat-label">Ng∆∞·ªùi d√πng</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalProducts">0</div>
                    <div class="stat-label">S·∫£n ph·∫©m</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalOrders">0</div>
                    <div class="stat-label">ƒê∆°n h√†ng</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalRevenue">0‚Ç´</div>
                    <div class="stat-label">Doanh thu</div>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 2rem;">
                <div>
                    <h3>üìà S·∫£n ph·∫©m b√°n ch·∫°y</h3>
                    <div id="topProducts"></div>
                </div>
                <div>
                    <h3>üì¶ T√¨nh tr·∫°ng kho</h3>
                    <div id="stockStatus"></div>
                </div>
            </div>
        </div>

        <!-- Users Section -->
        <div id="users" class="section">
            <div class="section-header">
                <h2 class="section-title">üë• Qu·∫£n l√Ω ng∆∞·ªùi d√πng</h2>
                <button class="btn btn-primary" onclick="openUserModal()">
                    ‚ûï Th√™m ng∆∞·ªùi d√πng
                </button>
            </div>
            
            <div class="search-container">
                <input type="text" class="search-input" placeholder="üîç T√¨m ki·∫øm ng∆∞·ªùi d√πng..." 
                       onkeyup="searchTable('usersTable', this.value)">
            </div>

            <div class="table-container">
                <table id="usersTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>T√™n ƒëƒÉng nh·∫≠p</th>
                            <th>H·ªç t√™n</th>
                            <th>Email</th>
                            <th>Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody">
                        <!-- Data will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Categories Section -->
        <div id="categories" class="section">
            <div class="section-header">
                <h2 class="section-title">üìÇ Qu·∫£n l√Ω danh m·ª•c</h2>
                <button class="btn btn-primary" onclick="openCategoryModal()">
                    ‚ûï Th√™m danh m·ª•c
                </button>
            </div>
            
            <div class="search-container">
                <input type="text" class="search-input" placeholder="üîç T√¨m ki·∫øm danh m·ª•c..." 
                       onkeyup="searchTable('categoriesTable', this.value)">
            </div>

            <div class="table-container">
                <table id="categoriesTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>T√™n danh m·ª•c</th>
                            <th>S·ªë s·∫£n ph·∫©m</th>
                            <th>Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody id="categoriesTableBody">
                        <!-- Data will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Products Section -->
        <div id="products" class="section">
            <div class="section-header">
                <h2 class="section-title">üõãÔ∏è Qu·∫£n l√Ω s·∫£n ph·∫©m</h2>
                <button class="btn btn-primary" onclick="openProductModal()">
                    ‚ûï Th√™m s·∫£n ph·∫©m
                </button>
            </div>
            
            <div class="search-container">
                <input type="text" class="search-input" placeholder="üîç T√¨m ki·∫øm s·∫£n ph·∫©m..." 
                       onkeyup="searchTable('productsTable', this.value)">
            </div>

            <div class="table-container">
                <table id="productsTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>H√¨nh ·∫£nh</th>
                            <th>T√™n s·∫£n ph·∫©m</th>
                            <th>Danh m·ª•c</th>
                            <th>Gi√°</th>
                            <th>T·ªìn kho</th>
                            <th>Tr·∫°ng th√°i</th>
                            <th>Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody id="productsTableBody">
                        <!-- Data will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Orders Section -->
        <div id="orders" class="section">
            <div class="section-header">
                <h2 class="section-title">üìã Qu·∫£n l√Ω ƒë∆°n h√†ng</h2>
            </div>
            
            <div class="search-container">
                <input type="text" class="search-input" placeholder="üîç T√¨m ki·∫øm ƒë∆°n h√†ng..." 
                       onkeyup="searchTable('ordersTable', this.value)">
            </div>

            <div class="table-container">
                <table id="ordersTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Kh√°ch h√†ng</th>
                            <th>Ng√†y ƒë·∫∑t</th>
                            <th>T·ªïng ti·ªÅn</th>
                            <th>S·ªë s·∫£n ph·∫©m</th>
                            <th>Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody id="ordersTableBody">
                        <!-- Data will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- User Modal -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="userModalTitle">Th√™m ng∆∞·ªùi d√πng m·ªõi</h3>
                <button class="close" onclick="closeModal('userModal')">&times;</button>
            </div>
            <form id="userForm">
                <input type="hidden" id="userId">
                <div class="form-group">
                    <label class="form-label">T√™n ƒëƒÉng nh·∫≠p *</label>
                    <input type="text" class="form-control" id="username" required>
                </div>
                <div class="form-group">
                    <label class="form-label">M·∫≠t kh·∫©u *</label>
                    <input type="password" class="form-control" id="password" required>
                </div>
                <div class="form-group">
                    <label class="form-label">H·ªç t√™n</label>
                    <input type="text" class="form-control" id="fullName">
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-control" id="email">
                </div>
                <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1.5rem;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('userModal')">H·ªßy</button>
                    <button type="submit" class="btn btn-primary">L∆∞u</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Category Modal -->
    <div id="categoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="categoryModalTitle">Th√™m danh m·ª•c m·ªõi</h3>
                <button class="close" onclick="closeModal('categoryModal')">&times;</button>
            </div>
            <form id="categoryForm">
                <input type="hidden" id="categoryId">
                <div class="form-group">
                    <label class="form-label">T√™n danh m·ª•c *</label>
                    <input type="text" class="form-control" id="categoryName" required>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1.5rem;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('categoryModal')">H·ªßy</button>
                    <button type="submit" class="btn btn-primary">L∆∞u</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Product Modal -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="productModalTitle">Th√™m s·∫£n ph·∫©m m·ªõi</h3>
                <button class="close" onclick="closeModal('productModal')">&times;</button>
            </div>
            <form id="productForm">
                <input type="hidden" id="productId">
                <div class="form-group">
                    <label class="form-label">T√™n s·∫£n ph·∫©m *</label>
                    <input type="text" class="form-control" id="productName" required>
                </div>
                <div class="form-group">
                    <label class="form-label">M√¥ t·∫£</label>
                    <textarea class="form-control" id="productDescription" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Gi√° *</label>
                    <input type="number" class="form-control" id="productPrice" step="0.01" required>
                </div>
                <div class="form-group">
                    <label class="form-label">URL h√¨nh ·∫£nh</label>
                    <input type="url" class="form-control" id="productImageUrl">
                </div>
                <div class="form-group">
                    <label class="form-label">S·ªë l∆∞·ª£ng t·ªìn kho</label>
                    <input type="number" class="form-control" id="productStock" value="0">
                </div>
                <div class="form-group">
                    <label class="form-label">Danh m·ª•c *</label>
                    <select class="form-control" id="productCategory" required>
                        <option value="">Ch·ªçn danh m·ª•c</option>
                    </select>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1.5rem;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('productModal')">H·ªßy</button>
                    <button type="submit" class="btn btn-primary">L∆∞u</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Order Details Modal -->
    <div id="orderDetailsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Chi ti·∫øt ƒë∆°n h√†ng</h3>
                <button class="close" onclick="closeModal('orderDetailsModal')">&times;</button>
            </div>
            <div id="orderDetailsContent">
                <!-- Order details will be populated here -->
            </div>
        </div>
    </div>

    <script>
        // Sample data - In real application, this would come from database
        let users = [
            {id: 1, username: 'admin', password: 'admin123', full_name: 'Qu·∫£n tr·ªã vi√™n', email: 'admin@furniture.com'},
            {id: 2, username: 'user1', password: 'user123', full_name: 'Nguy·ªÖn VƒÉn A', email: 'user1@email.com'},
            {id: 3, username: 'user2', password: 'user123', full_name: 'Tr·∫ßn Th·ªã B', email: 'user2@email.com'}
        ];

        let categories = [
            {id: 1, name: 'Gh·∫ø'},
            {id: 2, name: 'Sofa'},
            {id: 3, name: 'Gi∆∞·ªùng'},
            {id: 4, name: 'T·ªß'},
            {id: 5, name: 'B√†n'},
            {id: 6, name: 'ƒê√®n'}
        ];

        let products = [
            {id: 1, name: 'Gh·∫ø vƒÉn ph√≤ng cao c·∫•p', description: 'Gh·∫ø vƒÉn ph√≤ng ergonomic', price: 2500000, image_url: '/api/placeholder/300/300', stock: 15, category_id: 1},
            {id: 2, name: 'Sofa da th·∫≠t 3 ch·ªó', description: 'Sofa da b√≤ cao c·∫•p', price: 15000000, image_url: '/api/placeholder/300/300', stock: 5, category_id: 2},
            {id: 3, name: 'Gi∆∞·ªùng ng·ªß g·ªó s·ªìi', description: 'Gi∆∞·ªùng ng·ªß 1m8 g·ªó s·ªìi t·ª± nhi√™n', price: 8000000, image_url: '/api/placeholder/300/300', stock: 8, category_id: 3},
            {id: 4, name: 'T·ªß qu·∫ßn √°o 4 c√°nh', description: 'T·ªß qu·∫ßn √°o g·ªó MDF', price: 6000000, image_url: '/api/placeholder/300/300', stock: 3, category_id: 4},
            {id: 5, name: 'B√†n ƒÉn 6 ch·ªó', description: 'B√†n ƒÉn g·ªó cao su', price: 4500000, image_url: '/api/placeholder/300/300', stock: 10, category_id: 5}
        ];

        let orders = [
            {id: 1, user_id: 2, order_date: '2024-11-15 10:30:00', total_price: 17500000, details: [{product_id: 1, quantity: 2, price: 2500000}, {product_id: 2, quantity: 1, price: 15000000}]},
            {id: 2, user_id: 3, order_date: '2024-11-16 14:20:00', total_price: 8000000, details: [{product_id: 3, quantity: 1, price: 8000000}]},
            {id: 3, user_id: 2, order_date: '2024-11-17 09:15:00', total_price: 10500000, details: [{product_id: 4, quantity: 1, price: 6000000}, {product_id: 5, quantity: 1, price: 4500000}]}
        ];

        let nextUserId = 4;
        let nextCategoryId = 7;
        let nextProductId = 6;
        let nextOrderId = 4;

        // Navigation functions
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
            
            // Load data for the section
            loadSectionData(sectionId);
        }

        function loadSectionData(sectionId) {
            switch(sectionId) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'users':
                    loadUsers();
                    break;
                case 'categories':
                    loadCategories();
                    break;
                case 'products':
                    loadProducts();
                    break;
                case 'orders':
                    loadOrders();
                    break;
            }
        }

        // Dashboard functions
        function loadDashboard() {
            document.getElementById('totalUsers').textContent = users.length;
            document.getElementById('totalProducts').textContent = products.length;
            document.getElementById('totalOrders').textContent = orders.length;
            
            const totalRevenue = orders.reduce((sum, order) => sum + order.total_price, 0);
            document.getElementById('totalRevenue').textContent = formatCurrency(totalRevenue);
            
            loadTopProducts();
            loadStockStatus();
        }

        function loadTopProducts() {
            const productSales = {};
            orders.forEach(order => {
                order.details.forEach(detail => {
                    if (!productSales[detail.product_id]) {
                        productSales[detail.product_id] = 0;
                    }
                    productSales[detail.product_id] += detail.quantity;
                });
            });

            const topProducts = Object.entries(productSales)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5)
                .map(([productId, quantity]) => {
                    const product = products.find(p => p.id == productId);
                    return {product: product.name, quantity};
                });

            const html = topProducts.map(item => 
                `<div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #eee;">
                    <span>${item.product}</span>
                    <span class="badge badge-success">${item.quantity} ƒë√£ b√°n</span>
                </div>`
            ).join('');

            document.getElementById('topProducts').innerHTML = html;
        }

        function loadStockStatus() {
            const lowStock = products.filter(p => p.stock < 5);
            const outOfStock = products.filter(p => p.stock === 0);
            
            const html = `
                <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #eee;">
                    <span>S·∫Øp h·∫øt h√†ng (< 5)</span>
                    <span class="badge badge-warning">${lowStock.length} s·∫£n ph·∫©m</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 0.5rem 0;">
                    <span>H·∫øt h√†ng</span>
                    <span class="badge badge-danger">${outOfStock.length} s·∫£n ph·∫©m</span>
                </div>
            `;
            
            document.getElementById('stockStatus').innerHTML = html;
        }

        // Users functions
        function loadUsers() {
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = users.map(user => `
                <tr>
                    <td>${user.id}</td>
                    <td>${user.username}</td>
                    <td>${user.full_name || '-'}</td>
                    <td>${user.email || '-'}</td>
                    <td>
                        <button class="btn btn-warning btn-sm" onclick="editUser(${user.id})">‚úèÔ∏è S·ª≠a</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteUser(${user.id})">üóëÔ∏è X√≥a</button>
                    </td>
                </tr>
            `).join('');
        }

        function openUserModal(userId = null) {
            const modal = document.getElementById('userModal');
            const form = document.getElementById('userForm');
            
            if (userId) {
                const user = users.find(u => u.id === userId);
                document.getElementById('userModalTitle').textContent = 'S·ª≠a th√¥ng tin ng∆∞·ªùi d√πng';
                document.getElementById('userId').value = user.id;
                document.getElementById('username').value = user.username;
                document.getElementById('password').value = user.password;
                document.getElementById('fullName').value = user.full_name || '';
                document.getElementById('email').value = user.email || '';
            } else {
                document.getElementById('userModalTitle').textContent = 'Th√™m ng∆∞·ªùi d√πng m·ªõi';
                form.reset();
                document.getElementById('userId').value = '';
            }
            
            modal.classList.add('show');
        }

        function editUser(userId) {
            openUserModal(userId);
        }

        function deleteUser(userId) {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ng∆∞·ªùi d√πng n√†y?')) {
                users = users.filter(u => u.id !== userId);
                loadUsers();
                loadDashboard();
            }
        }

        // Categories functions
        function loadCategories() {
            const tbody = document.getElementById('categoriesTableBody');
            tbody.innerHTML = categories.map(category => {
                const productCount = products.filter(p => p.category_id === category.id).length;
                return `
                    <tr>
                        <td>${category.id}</td>
                        <td>${category.name}</td>
                        <td>${productCount}</td>
                        <td>
                            <button class="btn btn-warning btn-sm" onclick="editCategory(${category.id})">‚úèÔ∏è S·ª≠a</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteCategory(${category.id})">üóëÔ∏è X√≥a</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function openCategoryModal(categoryId = null) {
            const modal = document.getElementById('categoryModal');
            const form = document.getElementById('categoryForm');
            
            if (categoryId) {
                const category = categories.find(c => c.id === categoryId);
                document.getElementById('categoryModalTitle').textContent = 'S·ª≠a danh m·ª•c';
                document.getElementById('categoryId').value = category.id;
                document.getElementById('categoryName').value = category.name;
            } else {
                document.getElementById('categoryModalTitle').textContent = 'Th√™m danh m·ª•c m·ªõi';
                form.reset();
                document.getElementById('categoryId').value = '';
            }
            
            modal.classList.add('show');
        }

        function editCategory(categoryId) {
            openCategoryModal(categoryId);
        }

        function deleteCategory(categoryId) {
            const hasProducts = products.some(p => p.category_id === categoryId);
            if (hasProducts) {
                alert('Kh√¥ng th·ªÉ x√≥a danh m·ª•c n√†y v√¨ c√≤n s·∫£n ph·∫©m thu·ªôc danh m·ª•c!');
                return;
            }
            
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a danh m·ª•c n√†y?')) {
                categories = categories.filter(c => c.id !== categoryId);
                loadCategories();
                loadDashboard();
            }
        }

        // Products functions
        function loadProducts() {
            const tbody = document.getElementById('productsTableBody');
            tbody.innerHTML = products.map(product => {
                const category = categories.find(c => c.id === product.category_id);
                const stockStatus = product.stock === 0 ? 'badge-danger' : 
                                  product.stock < 5 ? 'badge-warning' : 'badge-success';
                const stockText = product.stock === 0 ? 'H·∫øt h√†ng' : 
                                 product.stock < 5 ? 'S·∫Øp h·∫øt' : 'C√≤n h√†ng';
                
                return `
                    <tr>
                        <td>${product.id}</td>
                        <td>
                            <img src="${product.image_url || '/api/placeholder/50/50'}" 
                                 alt="${product.name}" class="product-image">
                        </td>
                        <td>${product.name}</td>
                        <td>${category ? category.name : '-'}</td>
                        <td>${formatCurrency(product.price)}</td>
                        <td>${product.stock}</td>
                        <td><span class="badge ${stockStatus}">${stockText}</span></td>
                        <td>
                            <button class="btn btn-warning btn-sm" onclick="editProduct(${product.id})">‚úèÔ∏è S·ª≠a</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteProduct(${product.id})">üóëÔ∏è X√≥a</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function openProductModal(productId = null) {
            const modal = document.getElementById('productModal');
            const form = document.getElementById('productForm');
            const categorySelect = document.getElementById('productCategory');
            
            // Populate category dropdown
            categorySelect.innerHTML = '<option value="">Ch·ªçn danh m·ª•c</option>' + 
                categories.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
            
            if (productId) {
                const product = products.find(p => p.id === productId);
                document.getElementById('productModalTitle').textContent = 'S·ª≠a s·∫£n ph·∫©m';
                document.getElementById('productId').value = product.id;
                document.getElementById('productName').value = product.name;
                document.getElementById('productDescription').value = product.description || '';
                document.getElementById('productPrice').value = product.price;
                document.getElementById('productImageUrl').value = product.image_url || '';
                document.getElementById('productStock').value = product.stock;
                document.getElementById('productCategory').value = product.category_id;
            } else {
                document.getElementById('productModalTitle').textContent = 'Th√™m s·∫£n ph·∫©m m·ªõi';
                form.reset();
                document.getElementById('productId').value = '';
            }
            
            modal.classList.add('show');
        }

        function editProduct(productId) {
            openProductModal(productId);
        }

        function deleteProduct(productId) {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a s·∫£n ph·∫©m n√†y?')) {
                products = products.filter(p => p.id !== productId);
                loadProducts();
                loadDashboard();
            }
        }

        // Orders functions
        function loadOrders() {
            const tbody = document.getElementById('ordersTableBody');
            tbody.innerHTML = orders.map(order => {
                const user = users.find(u => u.id === order.user_id);
                const itemCount = order.details.reduce((sum, detail) => sum + detail.quantity, 0);
                
                return `
                    <tr>
                        <td>${order.id}</td>
                        <td>${user ? user.full_name || user.username : 'N/A'}</td>
                        <td>${formatDateTime(order.order_date)}</td>
                        <td>${formatCurrency(order.total_price)}</td>
                        <td>${itemCount}</td>
                        <td>
                            <button class="btn btn-primary btn-sm" onclick="viewOrderDetails(${order.id})">üëÅÔ∏è Chi ti·∫øt</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteOrder(${order.id})">üóëÔ∏è X√≥a</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function viewOrderDetails(orderId) {
            const order = orders.find(o => o.id === orderId);
            const user = users.find(u => u.id === order.user_id);
            
            const detailsHtml = order.details.map(detail => {
                const product = products.find(p => p.id === detail.product_id);
                return `
                    <tr>
                        <td>${product ? product.name : 'N/A'}</td>
                        <td>${detail.quantity}</td>
                        <td>${formatCurrency(detail.price)}</td>
                        <td>${formatCurrency(detail.quantity * detail.price)}</td>
                    </tr>
                `;
            }).join('');
            
            const content = `
                <div style="margin-bottom: 1rem;">
                    <strong>ƒê∆°n h√†ng #${order.id}</strong><br>
                    <strong>Kh√°ch h√†ng:</strong> ${user ? user.full_name || user.username : 'N/A'}<br>
                    <strong>Email:</strong> ${user ? user.email || '-' : 'N/A'}<br>
                    <strong>Ng√†y ƒë·∫∑t:</strong> ${formatDateTime(order.order_date)}<br>
                    <strong>T·ªïng ti·ªÅn:</strong> ${formatCurrency(order.total_price)}
                </div>
                
                <h4>Chi ti·∫øt s·∫£n ph·∫©m:</h4>
                <table style="width: 100%; border-collapse: collapse; margin-top: 1rem;">
                    <thead>
                        <tr style="background: #f8f9fa;">
                            <th style="padding: 0.5rem; border: 1px solid #dee2e6;">S·∫£n ph·∫©m</th>
                            <th style="padding: 0.5rem; border: 1px solid #dee2e6;">S·ªë l∆∞·ª£ng</th>
                            <th style="padding: 0.5rem; border: 1px solid #dee2e6;">ƒê∆°n gi√°</th>
                            <th style="padding: 0.5rem; border: 1px solid #dee2e6;">Th√†nh ti·ªÅn</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${detailsHtml}
                    </tbody>
                </table>
            `;
            
            document.getElementById('orderDetailsContent').innerHTML = content;
            document.getElementById('orderDetailsModal').classList.add('show');
        }

        function deleteOrder(orderId) {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ƒë∆°n h√†ng n√†y?')) {
                orders = orders.filter(o => o.id !== orderId);
                loadOrders();
                loadDashboard();
            }
        }

        // Form handlers
        document.getElementById('userForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const userId = document.getElementById('userId').value;
            const userData = {
                username: document.getElementById('username').value,
                password: document.getElementById('password').value,
                full_name: document.getElementById('fullName').value,
                email: document.getElementById('email').value
            };
            
            if (userId) {
                // Update existing user
                const index = users.findIndex(u => u.id == userId);
                users[index] = { ...users[index], ...userData };
            } else {
                // Add new user
                users.push({ id: nextUserId++, ...userData });
            }
            
            closeModal('userModal');
            loadUsers();
            loadDashboard();
        });

        document.getElementById('categoryForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const categoryId = document.getElementById('categoryId').value;
            const categoryData = {
                name: document.getElementById('categoryName').value
            };
            
            if (categoryId) {
                // Update existing category
                const index = categories.findIndex(c => c.id == categoryId);
                categories[index] = { ...categories[index], ...categoryData };
            } else {
                // Add new category
                categories.push({ id: nextCategoryId++, ...categoryData });
            }
            
            closeModal('categoryModal');
            loadCategories();
            loadProducts(); // Refresh products to show updated category names
        });

        document.getElementById('productForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const productId = document.getElementById('productId').value;
            const productData = {
                name: document.getElementById('productName').value,
                description: document.getElementById('productDescription').value,
                price: parseFloat(document.getElementById('productPrice').value),
                image_url: document.getElementById('productImageUrl').value,
                stock: parseInt(document.getElementById('productStock').value),
                category_id: parseInt(document.getElementById('productCategory').value)
            };
            
            if (productId) {
                // Update existing product
                const index = products.findIndex(p => p.id == productId);
                products[index] = { ...products[index], ...productData };
            } else {
                // Add new product
                products.push({ id: nextProductId++, ...productData });
            }
            
            closeModal('productModal');
            loadProducts();
            loadDashboard();
        });

        // Modal functions
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        // Search function
        function searchTable(tableId, searchTerm) {
            const table = document.getElementById(tableId);
            const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                const cells = row.getElementsByTagName('td');
                let found = false;
                
                for (let j = 0; j < cells.length - 1; j++) { // Exclude action column
                    if (cells[j].textContent.toLowerCase().includes(searchTerm.toLowerCase())) {
                        found = true;
                        break;
                    }
                }
                
                row.style.display = found ? '' : 'none';
            }
        }

        // Utility functions
        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN', {
                style: 'currency',
                currency: 'VND'
            }).format(amount);
        }

        function formatDateTime(dateString) {
            return new Date(dateString).toLocaleString('vi-VN');
        }

        // Close modal when clicking outside
        window.addEventListener('click', function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.classList.remove('show');
                }
            });
        });

        // Initialize dashboard on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboard();
        });